# Basic
pipeline_is_stereo: True
automatic_reinitialization: True # When lost, stereo can recover immediately
relocalization_max_trials: 5

# Stereo triangulation depth range
max_depth_inv: 0.05
min_depth_inv: 2.0
mean_depth_inv: 0.3

# IMU
# Normally the prior should be 0 if not using IMU.
use_imu: True
img_align_prior_lambda_rot: 5.0 # Gyroscope prior in sparse image alignment
img_align_prior_lambda_trans: 0.0 # Constant velocity assumption prior in sparse image alignment
poseoptim_prior_lambda: 2.0 # Gyroscope prior in pose optimization

# Dense input
publish_every_nth_dense_input: 5

# Visualization
publish_marker_scale: 0.5
publish_active_kfs: true

# Keyframe selection
max_n_kfs: 10 # keyframe number, decrease to 5 for higher speed
kfselect_criterion: FORWARD
# The following kfselect_* ONLY affects FORWARD
# If the number of features: >upper, no keyframe; <lower, take keyframe
kfselect_numkfs_upper_thresh: 160
kfselect_numkfs_lower_thresh: 70
# If the current frame is within the following range of any visible keyframes,
# do not take a new keyframe.
kfselect_min_num_frames_between_kfs: 2 # ..except this.
# If the median disparity from the last keyframe is smaller,
# do not take a new keyframe
# You can lower this value for more keyframes
kfselect_min_disparity: 30
kfselect_min_angle: 20
kfselect_min_dist_metric: 1.1
# When taking a new keyframe,
# we can already update the newly initialized seeds with old keyframes.
# This is important for forward looking case.
update_seeds_with_old_keyframes: True


# Affine compensation
# Default affine compensation parameters
# Most of the parameters are set to false for the consideration of processing time.
# If you observe bad tracking because of light/expousre change,
# enable the following parameters.
img_align_est_illumination_gain: false
img_align_est_illumination_offset: false
depth_filter_affine_est_offset: false
depth_filter_affine_est_gain: false
reprojector_affine_est_offset: false
reprojector_affine_est_gain: false

# Image Alignment
img_align_max_level: 5 # increase this level by one from 4 if image is double the size of VGA
img_align_min_level: 2
poseoptim_thresh: 3.0 # reprojection threshold, maybe make a bit larger for larger images.


# Initialization
# For a higher resolution, increase the value accordingly.
init_min_disparity: 15
init_method: FivePoint #RotationVsTranslation
# Map scale when initialized (not used for stereo)
# Increase if the initial scene depth is larger
map_scale: 1.0

# Reprojection
use_async_reprojectors: True # For stereo, use multithreading in reprojector
reprojector_max_n_kfs: 10 # Local map size. Larger is computationally more intensive. More reduces drift.


# Feature detection
max_fts: 180 # Feature number, decrease to 120 for higher speed
grid_size: 50 # Larger for larger images, for every cell you have max one feature
n_pyr_levels: 4 # Increase for larger images (image align max minus one)
detector_threshold_primary: 20 # Fast detector threshold - default = 10
detector_threshold_secondary: 250 # Edgelet detector threshold
detector_threshold_shitomasi: 50 # Map Point detector threshold

# Depth Filter
# How many times does the covariance need to decrease until a seed is considered converged.
# Increase to get more accurate points
seed_convergence_sigma2_thresh: 200
mappoint_convergence_sigma2_thresh: 500

# Disable ceres backend
use_ceres_backend: false
